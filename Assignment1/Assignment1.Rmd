---
title: "Econometrics II - Assignment 5"
author: "Think of something new"
date: "13 Mar 2022"
output:
  pdf_document:
    includes:
      in_header: "preamble.tex"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(forecast)
library(TSstudio)
library(stringr)
library(zoo)
library(ggplot2)
library(tseries)
library(stats)
library(lmtest)
library(Metrics)
```

# Question 1

```{r}
# Load data
data <- read.csv("data_assign_p1.csv")
```

1.) Plot the sample of Dutch GDP quarterly growth rates that you have at your disposal. Report the 12-period sample ACF and PACF functions and comment on their shape. What does the sample ACF tells you about the dynamic properties of GDP quarterly growth rates?

```{r}
fmt <- "%YQ%q"
data$obs <- as.yearqtr(data$obs, format = fmt)
```


```{r}
ggplot(data, aes(obs, GDP_QGR)) + 
  geom_point() + 
  geom_line() +
  scale_x_yearqtr(format = fmt)
```
```{r}
Acf(
  data$GDP_QGR,
  lag.max = 12
)
```
```{r}
Pacf(
  data$GDP_QGR,
  lag.max = 12
)
```

2.) Estimate an AR(p) model for the same time-series. Please use the general-to-specific modeling approach by starting with a total p = 4 lags and removing insignificant lags sequentially. Report the final estimated AR(p) model, working at a 5% significance level. Comment on the estimated coefficients. What do these coefficients tell you about the dynamic properties of the GDP quarterly growth rate?


```{r}
ar4 <- arima(data$GDP_QGR, order = c(4,0,0))
coeftest(ar4)
```

```{r}
ar3 <- arima(data$GDP_QGR, order = c(3,0,0))
coeftest(ar3)
```

```{r}
ar2 <- arima(data$GDP_QGR, order = c(2,0,0))
coeftest(ar2)
```

```{r}
ar1 <- arima(data$GDP_QGR, order = c(1,0,0))
coeftest(ar1)
```

3.) Check the regression residuals of the estimated AR(p) model for autocorrelation by plotting the estimated residual ACF function. Does the model seem well specified?
```{r}
checkresiduals(ar1)
```

4.) Make use of your estimated AR model to produce a 2-year (8 quarters) forecast for the Dutch GDP quarterly growth rate that spans until the first quarter of 2011. Report the values you obtained and explain how you derived them.

```{r}
plot(predict(ar1, n.ahead=8)$pred, type="l")
```
```{r}
ts.plot(data$GDP_QGR[-(1:40)])
forecast1 <- predict(ar1, n.ahead=8)$pred
se1 <- predict(ar1, n.ahead=8)$se
points(forecast1, type="l", col=2)
```
add to previous graph for sake of visual sanity, add quarters on axis

5.)  Suppose that the innovations in your AR model are iid Gaussian. Produce 95% confidence intervals for your 2-year forecast. Furthermore, comment on the following statement issued by government officials: “Given the available GDP data, we believe that there is a low probability that the Dutch GDP growth rate will remain negative in the second quarter of 2009.”
```{r}
ts.plot(data$GDP_QGR)
forecast1 <- predict(ar1, n.ahead=8)$pred
se1 <- predict(ar1, n.ahead=8)$se
points(forecast1, type="l", col=2)
points(forecast1 - 1.96*se1, type="l", col=2, lty=2)
points(forecast1 + 1.96*se1, type="l", col=2, lty=2)
```
figure out axis and add

```{r}
t_stat = (forecast1[1]-0)/se1[1]
n = length(data$obs)
pt(t_stat, n-2, lower.tail = FALSE)
```

6.) Do you find the assumption of iid Gaussian innovations reasonable? How does this affect your answer to the previous question?

7.) Suppose that 2 years have passed since you delivered your forecasts to the government, in the first quarter of 2009. Compare your point forecasts and confidence bounds with the following actual observed values for the 12 quarters from 2009q2 to 2011q1. Please comment on the accuracy of your forecasts.
```{r}
ts.plot(data$GDP_QGR)
forecast1 <- predict(ar1, n.ahead=8)$pred
se1 <- predict(ar1, n.ahead=8)$se
re <- ts(c(-1.63,0.28, 0.33, 0.66, 1.59, 0.51, 0.71, 0.81), start=89, end=96)
points(forecast1, type="l", col=2)
points(forecast1 - 1.96*se1, type="l", col=2, lty=2)
points(forecast1 + 1.96*se1, type="l", col=2, lty=2)
points(re, type="l", col=3)
```

8.) Repeat question 2 above, but this time using a 10% significance level for the generalto-specific modeling approach. Use the newly estimated model to produce a 2-year (8 quarters) point forecast of the Dutch GDP quarterly growth rate. Comment on the accuracy of the forecast generated by the newly estimated AR model. Is it better than the model you estimated before?
```{r}
ts.plot(data$GDP_QGR)
forecast1 <- predict(ar1, n.ahead=8)$pred
se1 <- predict(ar1, n.ahead=8)$se
forecast3 <- predict(ar3, n.ahead=8)$pred
se3 <- predict(ar3, n.ahead=8)$se
re <- ts(c(-1.63,0.28, 0.33, 0.66, 1.59, 0.51, 0.71, 0.81), start=89, end=96)
points(forecast1, type="l", col=2)
points(forecast1 - 1.96*se1, type="l", col=2, lty=2)
points(forecast1 + 1.96*se1, type="l", col=2, lty=2)
points(forecast3, type="l", col=4)
points(forecast3 - 1.96*se3, type="l", col=4, lty=2)
points(forecast3 + 1.96*se3, type="l", col=4, lty=2)
points(re, type="l", col=3)
```
```{r}
rmse(re, forecast1)
rmse(re, forecast3)
error1 <-  re - forecast1
error3 <- re - forecast3
dm.test(error1, error3)
```

